{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useCallback } from 'react';\nimport Router from 'next/router';\nimport ShopItemsLoading from '../../components/shop/ShopItemsLoading';\nimport ShopItemsComp from '../../components/shop/ShopItmes';\nimport ShopItemDetailComp from '../../components/shop/ShopItemDetail';\nimport ShopItemsByClassified from '../../components/shop/ShopItemsByClassified';\n\nvar ShopItems = function ShopItems(_ref) {\n  var shopId = _ref.shopId,\n      products = _ref.products,\n      classifiedId = _ref.classifiedId,\n      productId = _ref.productId;\n\n  var _useState = useState({}),\n      productsByClassify = _useState[0],\n      setProductsByClassify = _useState[1];\n\n  var _useState2 = useState([]),\n      selectedProducts = _useState2[0],\n      setSelectedProducts = _useState2[1];\n\n  var _useState3 = useState([]),\n      sortedSelectedProducts = _useState3[0],\n      setSortedSelectedProducts = _useState3[1];\n\n  var _useState4 = useState(null),\n      selectedProduct = _useState4[0],\n      setSelectedProduct = _useState4[1];\n\n  var _useState5 = useState(false),\n      isSortByTitle = _useState5[0],\n      setIsSortByTitle = _useState5[1];\n\n  var getSelectedProduct = useCallback(function (candidates, id) {\n    return Object.values(candidates).filter(function (product) {\n      if (product) {\n        return product.id === id;\n      }\n    });\n  }, []);\n  var clickClassify = useCallback(function (classify) {\n    setSelectedProducts(_toConsumableArray(productsByClassify[classify]));\n    setSortedSelectedProducts(_toConsumableArray(productsByClassify[classify]));\n    Router.push({\n      pathname: '/shop',\n      query: {\n        id: shopId,\n        classifiedId: encodeURI(classify)\n      }\n    });\n  }, [shopId, productsByClassify]);\n  var clickProduct = useCallback(function (id) {\n    var selectedProductArr = getSelectedProduct(sortedSelectedProducts, id);\n    setSelectedProduct(selectedProductArr[0]);\n    Router.push({\n      pathname: '/shop',\n      query: {\n        id: shopId,\n        classifiedId: encodeURI(classifiedId),\n        productId: selectedProductArr[0].id\n      }\n    });\n  }, [shopId, classifiedId, sortedSelectedProducts]);\n\n  var sortByTitle = function sortByTitle() {\n    var newProducts = _toConsumableArray(sortedSelectedProducts);\n\n    newProducts.sort(function (a, b) {\n      if (isSortByTitle) {\n        if (a.title < b.title) {\n          return 1;\n        }\n\n        if (a.title > b.title) {\n          return -1;\n        }\n      } else {\n        if (a.title < b.title) {\n          return -1;\n        }\n\n        if (a.title > b.title) {\n          return 1;\n        }\n      }\n\n      return 0;\n    });\n    setIsSortByTitle(!isSortByTitle);\n    setSortedSelectedProducts(newProducts);\n  };\n\n  var getItemNumber = function getItemNumber(product) {\n    if (product.specification) {\n      return \"\".concat(product.specification[0].number.split('-')[0], \"-\").concat(product.specification[0].number.split('-')[1]);\n    }\n\n    return '';\n  };\n\n  var findByText = function findByText(findedText) {\n    var lowerText = findedText.toLowerCase();\n    var newProducts = products.filter(function (product) {\n      if (product.title.toLowerCase().indexOf(lowerText) > -1) {\n        return true;\n      }\n\n      if (getItemNumber(product).toLowerCase().indexOf(lowerText) > -1) {\n        return true;\n      }\n\n      return false;\n    });\n    setSortedSelectedProducts(newProducts);\n  };\n\n  var setInitItems = function setInitItems() {\n    setSortedSelectedProducts(_toConsumableArray(selectedProducts));\n    setIsSortByTitle(false);\n  };\n\n  useEffect(function () {\n    var classifiedProducts = products.reduce(function (acc, cur) {\n      if (cur) {\n        if (cur.classify) {\n          if (acc[cur.classify]) {\n            acc[cur.classify].push(cur);\n          } else {\n            acc[cur.classify] = [cur];\n          }\n        }\n      }\n\n      return acc;\n    }, {});\n\n    if (productId) {\n      var selectedProductArr = getSelectedProduct(products, productId);\n      setSelectedProduct(selectedProductArr[0]);\n    }\n\n    if (classifiedId && classifiedProducts[classifiedId]) {\n      setSelectedProducts(_toConsumableArray(classifiedProducts[classifiedId]));\n      setSortedSelectedProducts(_toConsumableArray(classifiedProducts[classifiedId]));\n    }\n\n    setProductsByClassify(classifiedProducts);\n  }, [shopId, products]);\n\n  var renderShops = function renderShops() {\n    if (!products || products.length < 1) {\n      return __jsx(ShopItemsLoading, null);\n    }\n\n    if (classifiedId && productId && selectedProduct) {\n      return __jsx(ShopItemDetailComp, {\n        type: selectedProduct.type,\n        id: selectedProduct.id,\n        image: selectedProduct.image,\n        title: selectedProduct.title,\n        content: selectedProduct.content,\n        specification: selectedProduct.specification,\n        tableItems: selectedProduct.tableItems || [],\n        classifiedId: selectedProduct.classify\n      });\n    }\n\n    if (classifiedId) {\n      return __jsx(ShopItemsComp, {\n        products: sortedSelectedProducts,\n        onClickProduct: clickProduct,\n        sortByTitle: sortByTitle,\n        isSortByTitle: isSortByTitle,\n        findByText: findByText,\n        setInitItems: setInitItems\n      });\n    }\n\n    return __jsx(ShopItemsByClassified, {\n      shopId: shopId,\n      products: productsByClassify,\n      clickClassify: clickClassify\n    });\n  };\n\n  return __jsx(React.Fragment, null, renderShops());\n};\n\nShopItems.defaultProps = {\n  classifiedId: null,\n  productId: null\n};\nexport default ShopItems;","map":null,"metadata":{},"sourceType":"module"}